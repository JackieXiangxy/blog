<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ust.myapp.mapper.ArticleMapper">
	<resultMap id="BaseResultMap"
		type="com.ust.myapp.model.Article">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="title" jdbcType="VARCHAR" property="title" />
		<result column="publish_time" jdbcType="TIMESTAMP"
			property="publishTime" />
		<result column="is_top" jdbcType="BIT" property="isTop" />
		<result column="is_delete" jdbcType="BIT" property="isDelete" />
		<result column="count" jdbcType="INTEGER" property="count" />
		<association property="user" column="user_id"
			select="com.ust.myapp.mapper.UserMapper.getUser" />
		<association property="category" column="category_id"
			select="getCategory" />
		<association property="sysCategory"
			column="sys_category_id" select="getSysCategory" />
		<collection property="comments" javaType="arraylist"
			ofType="com.ust.myapp.model.Comment"
			select="com.ust.myapp.mapper.CommentMapper.selectCommentByArticleId"
			column="id" />
	</resultMap>
	<resultMap extends="BaseResultMap" id="ResultMapWithBLOBs"
		type="com.ust.myapp.model.ArticleWithBLOBs">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="content" jdbcType="LONGVARCHAR"
			property="content" />
		<result column="summary" jdbcType="LONGVARCHAR"
			property="summary" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, title, user_id, sys_category_id, category_id, publish_time,
		is_top, is_delete,
		count
	</sql>
	<sql id="Blob_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		content, summary
	</sql>
	<select id="selectByPrimaryKey"
		parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->


		select
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from article
		where id = #{id,jdbcType=INTEGER}
	</select>


	<insert id="insert"
		parameterType="com.ust.myapp.model.ArticleWithBLOBs">

		insert into article (id, title, user_id,
		sys_category_id, category_id, publish_time,
		is_top, is_delete, count, content,
		summary)
		values (#{id,jdbcType=INTEGER}, 
		#{title,jdbcType=VARCHAR},
		#{user.id,jdbcType=INTEGER},
		#{sysCategory.id,jdbcType=INTEGER},
		#{category.id,jdbcType=INTEGER},
		#{publishTime,jdbcType=TIMESTAMP},
		#{isTop,jdbcType=BIT}, #{isDelete,jdbcType=BIT}, 
		#{count,jdbcType=INTEGER},
		#{content,jdbcType=LONGVARCHAR},
		#{summary,jdbcType=LONGVARCHAR})
	</insert>
	<insert id="insertSelective"
		parameterType="com.ust.myapp.model.ArticleWithBLOBs">

		insert into article
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="title != null">
				title,
			</if>
			<if test="user.id != null">
				user_id,
			</if>
			<if test="sysCategory.id != null">
				sys_category_id,
			</if>
			<if test="category.id!= null">
				category_id,
			</if>
			<if test="publishTime != null">
				publish_time,
			</if>
			<if test="isTop != null">
				is_top,
			</if>
			<if test="isDelete != null">
				is_delete,
			</if>
			<if test="count != null">
				count,
			</if>
			<if test="content != null">
				content,
			</if>
			<if test="summary != null">
				summary,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="title != null">
				#{title,jdbcType=VARCHAR},
			</if>
			<if test="user.id != null">
				#{user.id,jdbcType=INTEGER},
			</if>
			<if test="sysCategory.id != null">
				#{sysCategory.id,jdbcType=INTEGER},
			</if>
			<if test="category.id != null">
				#{category.id,jdbcType=INTEGER},
			</if>
			<if test="publishTime != null">
				#{publishTime,jdbcType=TIMESTAMP},
			</if>
			<if test="isTop != null">
				#{isTop,jdbcType=BIT},
			</if>
			<if test="isDelete != null">
				#{isDelete,jdbcType=BIT},
			</if>
			<if test="count != null">
				#{count,jdbcType=INTEGER},
			</if>
			<if test="content != null">
				#{content,jdbcType=LONGVARCHAR},
			</if>
			<if test="summary != null">
				#{summary,jdbcType=LONGVARCHAR},
			</if>
		</trim>
	</insert>




	<update id="updateByPrimaryKeySelective"
		parameterType="com.ust.myapp.model.ArticleWithBLOBs">

		update article
		<set>
			<if test="title != null">
				title = #{title,jdbcType=VARCHAR},
			</if>
			<if test="user.id != null">
				user_id = #{user.id,jdbcType=INTEGER},
			</if>
			<if test="sysCategory.id != null">
				sys_category_id = #{sysCategory.id,jdbcType=INTEGER},
			</if>
			<if test="category.id != null">
				category_id = #{category.id,jdbcType=INTEGER},
			</if>
			<if test="publishTime != null">
				publish_time = #{publishTime,jdbcType=TIMESTAMP},
			</if>
			<if test="isTop != null">
				is_top = #{isTop,jdbcType=BIT},
			</if>
			<if test="isDelete != null">
				is_delete = #{isDelete,jdbcType=BIT},
			</if>
			<if test="count != null">
				count = #{count,jdbcType=INTEGER},
			</if>
			<if test="content != null">
				content = #{content,jdbcType=LONGVARCHAR},
			</if>
			<if test="summary != null">
				summary = #{summary,jdbcType=LONGVARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}

	</update>
	<update id="updateByPrimaryKeyWithBLOBs"
		parameterType="com.ust.myapp.model.ArticleWithBLOBs">
		update article
		set title = #{title,jdbcType=VARCHAR},
		user_id = #{user.id,jdbcType=INTEGER},
		sys_category_id = #{sys_category.id,jdbcType=INTEGER},
		category_id = #{category_id.id,jdbcType=INTEGER},
		publish_time = #{publishTime,jdbcType=TIMESTAMP},
		is_top = #{isTop,jdbcType=BIT},
		is_delete = #{isDelete,jdbcType=BIT},
		count = #{count,jdbcType=INTEGER},
		content = #{content,jdbcType=LONGVARCHAR},
		summary = #{summary,jdbcType=LONGVARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey"
		parameterType="com.ust.myapp.model.Article">
		update article
		set title = #{title,jdbcType=VARCHAR},
		user_id = #{user.id,jdbcType=INTEGER},
		sys_category_id = #{sysCategory.id,jdbcType=INTEGER},
		category_id = #{category.id,jdbcType=INTEGER},
		publish_time = #{publishTime,jdbcType=TIMESTAMP},
		is_top = #{isTop,jdbcType=BIT},
		is_delete = #{isDelete,jdbcType=BIT},
		count = #{count,jdbcType=INTEGER}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<select id="count" resultType="java.lang.Integer">
		SELECT count(id) FROM article
	</select>
	<select id="countbyuserid" resultType="java.lang.Integer">
		SELECT count(*) FROM article where user_id=#{userId} AND is_delete=0
	</select>
	<select id="selectBySearch" resultMap="ResultMapWithBLOBs">
		SELECT
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from article
		<where>
			<if test="title != null">
				title LIKE CONCAT(CONCAT('%', #{title}), '%')
			</if>

			<if test="content != null">
				or content like CONCAT(CONCAT('%',#{content}),'%')
			</if>

			<if test="summary != null">
				or summary like CONCAT(CONCAT('%',#{summary}),'%')
			</if>
		</where>
	</select>
	<select id="getArticleByPage" resultMap="ResultMapWithBLOBs">
		SELECT
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from article
		limit #{curPage},#{size}
	</select>
	<select id="getArticlePageByUserId"
		resultMap="ResultMapWithBLOBs">

		SELECT
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from article as a
		where a.user_id=#{userId} AND  is_delete=0
		limit #{curPage},#{size}
		
		
	</select>
	<select id="topTenArticle" resultMap="ResultMapWithBLOBs">
		SELECT
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from article
		ORDER BY article.count DESC
		limit 0,10
		
	</select>

	<select id="getCategory" parameterType="int"
		resultMap="com.ust.myapp.mapper.CategoryMapper.BaseResultMap">
		SELECT
		<include
			refid="com.ust.myapp.mapper.CategoryMapper.Base_Column_List" />
		FROM category
		WHERE category.id = #{id}
	</select>

	<select id="getSysCategory" parameterType="int"
		resultMap="com.ust.myapp.mapper.SysCategoryMapper.BaseResultMap">
		SELECT
		<include
			refid="com.ust.myapp.mapper.SysCategoryMapper.Base_Column_List" />
		FROM sys_category
		WHERE sys_category.id = #{id}
	</select>

	<update id="updateByDelete" parameterType="java.lang.Integer">
		update article set is_delete=1 where id=#{id}

	</update>


</mapper>